# TutorLingua: Unified Experience Design Document
*Generated by Gemini 3 Pro — Feb 13, 2026*

---

## 1. Navigation Architecture

**Core Philosophy:** One Application, Two Modes (Management vs. Focus).
Instead of three separate nav systems, implement a single responsive `AppShell` that adapts based on `UserRole` (Guest, Student, Tutor) and `ViewMode` (Standard, Immersive).

### The Global Navigation Strategy
- **Desktop:** Left Sidebar (expandable/collapsible)
- **Mobile:** Bottom Navigation Bar
- **Immersive Mode (Practice):** Full screen with a "floating" exit/context header

### A. Unified Navigation Structure

**Student Context:**
- **Home:** Dashboard (Upcoming lessons, streak status)
- **Tutors:** Discovery/Search (formerly separate "Book")
- **Practice:** (Central/Primary Action)
- **Messages:** Chat with tutors
- **Profile:** Settings, billing, history

**Tutor Context:**
- **Home:** Dashboard (Overview, earnings, stats)
- **Calendar:** Schedule management
- **Students:** CRM (List, details, assignments)
- **Inbox:** Messages
- **Menu:** Services, Profile, Analytics

**Anonymous/Guest Context:**
- **Header:** Logo (Left), "For Tutors" (Link), "Log In" (Button), "Get Started" (CTA)
- **Footer:** Standard site links

### B. The "Practice" Bridge
Practice mode currently feels like a separate app.
- **Change:** Practice becomes a *modal route* or an *immersive page* wrapped in the main logic
- **Exit Strategy:** Persistent (but unobtrusive) "Exit" or "Back to Dashboard" button in top-left of Practice interface
- **Context Awareness:** If a student accesses Practice from a specific Assignment, the "Exit" button returns them to that Assignment details page

---

## 2. Complete User Journeys

### A. New Visitor → Student (The "Trust" Journey)
1. **Discovery:** User lands on `tutorlingua.com`
2. **Hook:** "Test your level now" (CTA pointing to Practice) OR "Find a Tutor"
3. **Action:** User enters Practice Mode (Anonymous)
4. **Value:** User completes a 3-minute placement test
5. **The Gate (Conversion):** Results page shows score "B1 Intermediate"
   - *CTA:* "Save my progress" (Soft Signup)
   - *CTA:* "Find tutors who teach B1" (Direct Tutor Search with pre-filled filter)
6. **Onboarding:** User signs up. The B1 result is saved to their profile
7. **First Booking:** Dashboard recommends tutors matching the B1 level

### B. Tutor Acquisition (The "Business" Journey)
1. **Landing:** "Teach on your terms" page
2. **Signup:** Create account → Set availability → Connect Stripe
3. **Profile Building:** Generate public slug `tutorlingua.com/@[username]`
4. **Activation:**
   - *Prompt:* "Send a level assessment to your existing students"
   - *Action:* Tutor shares a unique Practice Link
   - *Result:* Student takes test → Results sent to Tutor → Tutor is notified → "Propose Lesson" CTA appears

### C. Student Retention Loop (The "Homework" Cycle)
1. **Lesson:** Lesson completes
2. **Assignment:** Tutor assigns specific Practice module via Dashboard
3. **Notification:** Student gets push/email: "New drill from [Tutor Name]"
4. **Action:** Click link → Opens Practice Mode (Authenticated)
5. **Completion:** Results page
   - *Feedback:* "Great job! [Tutor Name] has been notified."
   - *CTA:* "Book next lesson to review" (if no lesson booked)
6. **Loop:** Student returns to Dashboard

### D. Anonymous Practice → Conversion (The "Hook")
1. **Inbound:** User clicks a shared result link (`/practice/result/[id]`)
2. **View:** Sees friend's score card + "Can you beat this?"
3. **Action:** "Accept Challenge" → Plays Practice Mode
4. **Result:**
   - *Win:* "You won! Share to brag."
   - *Loss:* "Get a tutor to improve."
5. **Conversion:** Bottom sheet: "Serious about Spanish? Get a pro tutor."

### E. Viral Loops (Unified)
- **The Object:** The "Language Card" (generated image/component showing Stats + Streak + Avatar)
- **The Trigger:** Completing a session or hitting a streak milestone
- **The Recipient Flow:**
  - Click Link → Landing Page (Personalised: "Beat [Name]'s score of 850") → **Instant Play** (No signup first)
  - *Why?* Lowest friction. Hook them with the game, capture them with the results

---

## 3. Practice Mode Integration

**Decision: Kill the standalone simulation. Evolve into a Responsive Focus View.**

- **Architecture:** Move Practice from a separate silo into the main app structure, but style it distinctly
- **Visual Integration:**
  - Keep the Dark Theme for practice to induce "Focus State"
  - **Desktop:** Centre the practice container (max-width 480px) on the screen. Blur the background (using the Light Theme colours/wallpaper). Creates a "modal" feel without losing context
  - **Mobile:** Full screen, but with a collapsible header that reveals the standard App Navigation
- **Data Integration:**
  - Practice results must write to a shared `ActivityLog` table
  - Tutor Dashboard needs to read from this table to show "Student Progress"

---

## 4. Layout & Responsive Strategy

### The "Responsive Container" Strategy

- **Mobile (< 768px):** Native feel. Bottom Nav. Content flows full width
- **Desktop (> 768px):**
  - **Sidebar:** Left side (250px)
  - **Main Content:** Centre fluid
  - **Right Rail (Student):** "Next Lesson" card, "Current Streak" widget
  - **Practice Mode:** Opens as a centred overlay/stage against a blurred backdrop of the dashboard

### Theme Strategy
Use **CSS Variables with Data Attributes** to handle the contrast between App (Light) and Practice (Dark).
- Wrap the Practice container in `<div data-theme="immersive">`
- This allows the rest of the app to stay Light while the practice area is Dark without a full page reload or jarring context switch

---

## 5. The "Completeness" Factor

What makes it feel like **ONE** product:

1. **Unified Typography:** Ensure *Manrope* is used consistently in Practice headers and buttons, matching the Dashboard
2. **Shared Components:** Use the same Avatar, Button, and Card shapes (Rounded-3xl) in Practice as in the Dashboard. Currently Practice uses "gamey" UI while Dashboard uses "SaaS" UI. Bridge this by using the SaaS UI components *inside* the game layout
3. **Persistent Profile:** The User Avatar should be visible in the corner of Practice mode (if logged in), grounding them in their identity
4. **Transitions:** Use `framer-motion` `layoutId` to morph the "Practice" card on the Dashboard into the full Practice screen

---

## 6. File-by-File Implementation Plan

### Phase 1: Structural Unification (Priority: HIGH)

#### 1. `components/layout/AppShell.tsx` (NEW)
- **Create:** Master layout component handling responsive sidebar/bottom nav logic
- **Props:** Accepts `variant` prop ('default' | 'immersive')
- **Logic:** If `variant='immersive'` (Practice), hide sidebar/bottom nav, show "Exit" button
- **Replaces:** The current fragmented `DashboardShell`, `StudentPortalLayout`, and Practice layout

#### 2. `components/navigation/UnifiedNav.tsx` (NEW)
- **Create:** Single navigation config that renders differently based on UserRole
- **Replaces:** `components/dashboard/bottom-nav.tsx` + `components/student-auth/StudentBottomNav.tsx`
- **Shares:** Same route CONFIG object to prevent drift between tutor and student nav

#### 3. `app/(practice)/layout.tsx` (MODIFY)
- **Remove:** Hard-coded 430px body lock, `bg-[#0D0D0C]`, `shadow-[0_0_80px...]`
- **New:** Wrap children in centred responsive container:
  ```tsx
  <div className="flex justify-center items-center min-h-screen bg-background/90 backdrop-blur">
    <main data-theme="immersive" className="w-full sm:max-w-[480px] min-h-screen sm:min-h-0 sm:rounded-3xl bg-[var(--immersive-background)] sm:shadow-2xl relative">
      {/* Exit button */}
      {children}
    </main>
  </div>
  ```

#### 4. `app/(dashboard)/layout.tsx` (MODIFY)
- **Change:** Replace `DashboardShell` with new `AppShell` variant='default'
- **Add:** Sidebar for desktop, keep bottom nav for mobile

#### 5. `components/student-auth/StudentPortalLayout.tsx` (MODIFY)
- **Change:** Replace with `AppShell` variant='default' using student nav config
- **Unify:** Same shell structure as tutor dashboard, different nav items

### Phase 2: Connecting the Journeys (Priority: HIGH)

#### 6. `app/(practice)/practice/result/[sessionId]/page.tsx` (OVERHAUL)
- **Current:** Shows score + basic share
- **New Logic:**
  - If Authenticated: "Save to Profile" (auto) + "Share" + "Book Lesson (Review)" + "Back to Dashboard"
  - If Anonymous: "Sign up to save score" + "Find Tutor for this level" + "Challenge a friend"
- **Add:** Tutor recommendation widget using calculated level
- **Add:** "Next steps" section with clear CTAs

#### 7. Student Dashboard — Add "Quick Practice" Card
- **File:** `app/student/search/page.tsx` or new `app/student/dashboard/page.tsx`
- **Add:** Card showing current streak + "Continue Practice" button
- **Visual:** Uses Practice dark theme inside a Dashboard light card (bridge element)

#### 8. Tutor Dashboard — Student Practice Activity
- **File:** `app/(dashboard)/dashboard/page.tsx`
- **Add:** "Student Activity" section showing recent practice completions
- **Data:** Read from `student_practice_sessions` table

#### 9. Practice Context Header (NEW)
- **File:** `components/practice/PracticeHeader.tsx` (NEW)
- **Contains:** Back arrow (context-aware), progress bar, XP counter, user avatar (if logged in)
- **Behaviour:** 
  - From assignment → "Back to Assignments"
  - From student dashboard → "Back to Dashboard"  
  - From anonymous → "TutorLingua" logo link
  - Collapses on scroll during exercises, expands on results

### Phase 3: Viral & Share Mechanics (Priority: MEDIUM)

#### 10. `lib/sharing.ts` (NEW)
- **Create:** Centralised sharing logic
- **Functions:** `generateChallengeUrl(score, name)`, `generateReferralUrl(user)`, `generateResultShareUrl(sessionId)`
- **Output:** Generates distinct OG Images for dynamic routes

#### 11. Challenge Landing Page (NEW)
- **File:** `app/(practice)/practice/challenge/landing/page.tsx` or modify existing `[challengerId]/page.tsx`
- **Flow:** Shows challenger's score + "Accept Challenge" button → Redirects to Practice with challenge context
- **No signup required** — lowest friction entry point

#### 12. Results → Tutor Discovery Bridge (NEW)
- **File:** `components/practice/TutorRecommendation.tsx` (NEW)
- **Shows:** 2-3 tutor cards filtered by the language just practiced
- **Appears:** On results page for anonymous users
- **CTA:** "Book a trial lesson" → routes to tutor's public profile

#### 13. Post-Lesson Assignment Flow
- **File:** `components/dashboard/AssignPracticeButton.tsx` (MODIFY)
- **Change:** After lesson completion, automatically suggest "Assign practice for this topic"
- **Data:** Pre-fill practice assignment based on lesson content/language

### Phase 4: Colour & Design Token Migration (Priority: MEDIUM)

#### 14. `app/globals.css` (MODIFY)
- **Add:** Immersive scope variables (as outlined in previous plan)
- **Add:** `[data-theme="immersive"]` selector that maps standard tokens to dark values

#### 15-34. Practice Components (19 files) — Migrate Hardcoded Hex
Same file list as previous plan. Replace all hardcoded `#E8784D`, `#0D0D0C`, `#1A1917`, `#F5F2EF`, `#5A7A5E` with CSS variable-backed Tailwind classes. Scoped inside `data-theme="immersive"` wrapper.

#### 35-41. Leaked Colour Cleanup (7 files)
Same as previous plan — clean `AssignPracticeButton`, `ReferralShareCard`, `HomeworkList`, `InstallPrompt`, `AssignmentsPageClient`, `tutor-ref page`, `referrals page`.

### Phase 5: Animation & Polish (Priority: LOW)

#### 42. `lib/animations.ts` (NEW)
- Shared spring transition constants
- Page variants, card hover, fade in
- Import across both dashboard and practice

#### 43. Landing Page Token Cleanup
- Replace `text-gray-700` → `text-muted-foreground` in Hero, FAQ, Footer, etc.

#### 44. Dashboard Card Animations
- Add subtle hover/tap animations to metric cards, session cards

---

## Summary: The Viral Loop (End to End)

```
Visitor → Landing Page → "Test Your Level" CTA
    ↓
Practice (Anonymous, No Signup) → 3-min Assessment
    ↓
Results Page → Score + Level + Share Button
    ↓
Share → Challenge Link → Friend Plays (Anonymous)
    ↓
Friend's Results → "Find a Tutor" CTA → Tutor Profiles
    ↓
Book Trial Lesson → Become Student → Dashboard
    ↓
Lesson Complete → Tutor Assigns Practice → Student Practises
    ↓
Results → Streak Share → Another Friend Clicks Link
    ↓
(Loop Repeats)
```

**Key Insight:** Practice is the top of funnel AND the retention mechanism. It serves two purposes:
1. **Acquisition:** Free, no-signup practice hooks new users
2. **Retention:** Tutor-assigned practice keeps students engaged between lessons

The viral loop works because:
- Sharing is tied to **achievement** (scores, streaks) — intrinsic motivation
- Shared links land on **instant play** — zero friction
- Results page bridges to **tutor discovery** — monetisation path
- Tutor assignments create **recurring practice** — retention
- Each practice session creates a new **shareable moment** — loop restarts
