# TutorLingua ‚Äî Design Specification
## Games Language Expansion + Pimsleur Audio Module
### Generated by Gemini 2.5 Flash ‚Äî 16 Feb 2026

---

## Task 1: Games Language Expansion to 10+ Languages

### 1. Language Picker UX (scales from 3‚Üí10+)

**UX Flow:**
1. User taps Language icon/button (flag or globe) in game header
2. Full-screen bottom sheet slides up with `LanguagePickerModal`
3. Search bar at top + scrollable list of languages
4. Each item shows flag (or üåê), native name, English name
5. "Coming Soon" badge for partially available languages
6. Tap selects, closes modal, reloads game

**Component Hierarchy:**

```typescript
// LanguagePickerButton.tsx
interface LanguagePickerButtonProps {
  currentLanguage: Language;
  onClick: () => void;
}

// LanguagePickerModal.tsx
interface LanguagePickerModalProps {
  isOpen: boolean;
  onClose: () => void;
  onSelectLanguage: (languageCode: string) => void;
  availableLanguages: Language[];
  currentLanguageCode: string;
}

// LanguagePickerItem.tsx
interface LanguagePickerItemProps {
  language: Language;
  isSelected: boolean;
  onSelect: (languageCode: string) => void;
}
```

**Tailwind Classes:**

```html
<!-- LanguagePickerButton -->
<button class="flex items-center gap-x-2 p-2 rounded-full bg-background/70 backdrop-blur-md border border-border/50 text-foreground hover:bg-background/80 transition-colors duration-200">
  <span class="text-xl">{flagEmoji || 'üåê'}</span>
  <span class="font-body text-sm font-medium hidden sm:inline-block">{name}</span>
</button>

<!-- LanguagePickerModal -->
<div class="fixed inset-0 z-50 bg-background/80 backdrop-blur-md flex flex-col p-4 sm:p-6">
  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <h2 class="font-heading text-3xl text-foreground">Choose a Language</h2>
    <button class="text-foreground/80 hover:text-foreground transition-colors">‚úï</button>
  </div>
  <!-- Search -->
  <input class="w-full p-3 mb-6 rounded-lg bg-background/50 border border-border/50 text-foreground font-body placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary" />
  <!-- List -->
  <ul class="flex-1 overflow-y-auto space-y-3 pb-8" />
</div>

<!-- LanguagePickerItem -->
<li class="flex items-center justify-between p-4 rounded-xl border border-border/50 bg-background/60 hover:bg-background/70 transition-colors cursor-pointer {isSelected ? 'border-primary ring-2 ring-primary' : ''}">
  <div class="flex items-center gap-x-3">
    <span class="text-3xl">{flagEmoji || 'üåê'}</span>
    <div>
      <p class="font-body text-lg font-medium text-foreground">{nativeName}</p>
      <p class="font-body text-sm text-muted-foreground">{name}</p>
    </div>
  </div>
</li>
```

**Framer Motion:**
```typescript
<motion.div
  initial={{ y: "100%" }}
  animate={{ y: isOpen ? "0%" : "100%" }}
  exit={{ y: "100%" }}
  transition={{ type: "spring", damping: 25, stiffness: 250, mass: 0.8, duration: 0.4 }}
/>
```

**Touch targets:** LanguagePickerItem min 48√ó48px via padding.

---

### 2. CJK Layout Changes

CJK characters need larger tiles and fewer grid columns.

**Design Tokens:**
```css
:root {
  --game-tile-size-latin-sm: 48px;
  --game-tile-size-latin-md: 56px;
  --game-tile-size-latin-lg: 64px;
  --game-tile-size-cjk-sm: 60px;
  --game-tile-size-cjk-md: 70px;
  --game-tile-size-cjk-lg: 80px;
  --game-grid-gap: 8px;
}
```

**Tailwind:**
```html
<!-- GameTile (conditional on scriptType) -->
<!-- Latin -->
<div class="w-[48px] h-[48px] sm:w-[56px] sm:h-[56px] md:w-[64px] md:h-[64px] text-2xl sm:text-3xl font-body" />
<!-- CJK (1.25√ó larger) -->
<div class="w-[60px] h-[60px] sm:w-[70px] sm:h-[70px] md:w-[80px] md:h-[80px] text-xl sm:text-2xl font-body font-semibold" />

<!-- Grid columns -->
<!-- Latin: grid-cols-5 sm:grid-cols-6 md:grid-cols-7 -->
<!-- CJK: grid-cols-4 sm:grid-cols-5 md:grid-cols-6 -->
```

---

### 3. Flag Representation (China controversy)

**Solution:**
- **Chinese**: No flags. Use text labels: "Chinese (Simplified)" / "Chinese (Traditional)" with `flagEmoji: null`
- **Japanese/Korean**: Standard flags (üáØüáµ/üá∞üá∑) ‚Äî less contentious
- **All others**: Standard country flags
- **Fallback**: Globe emoji üåê

```typescript
const chineseSimplified: Language = {
  code: 'zh-CN', name: 'Chinese (Simplified)', nativeName: 'ÁÆÄ‰Ωì‰∏≠Êñá',
  flagEmoji: null, status: 'available', scriptType: 'cjk',
  supportedGames: ['connections', 'odd-one-out']
};
```

---

### 4. Share Card Adaptation for Non-Latin Scripts

**Font fallback chain for CJK:**
```css
:root {
  --font-family-cjk: "Manrope", "Noto Sans JP", "Noto Sans KR", "Noto Sans SC", sans-serif;
}
```

- Use `font-heading` (Mansalva) for Latin share card titles
- Use `font-body` (Manrope) with CJK fallback chain for CJK content
- Emoji-based elements (üü®üü©üü¶üü™ grids, streak tiers) remain universal

---

### 5. Game Mechanics for CJK (Word Ladder)

Word Ladder ‚Üí **Character Ladder** for CJK. Change one character at a time.

```typescript
export type GameIdentifier = 'connections' | 'word-ladder-latin' | 'word-ladder-cjk' | 'daily-decode' | 'odd-one-out' | 'missing-piece' | 'synonym-spiral';

interface CharacterLadderPuzzle {
  startWord: string;    // e.g., "‰Ω†Â•Ω"
  endWord: string;      // e.g., "ÂÜçËßÅ"
  solutionPath: string[]; // Each step changes one character
}
```

Game component branches based on `scriptType`:
```typescript
if (language.scriptType === 'cjk') {
  return <CharacterLadderGame />;
}
return <LatinWordLadderGame />;
```

---

### 6. Graceful Degradation (Fewer Puzzles)

```typescript
interface Language {
  // ...
  supportedGames: GameIdentifier[]; // Controls which games appear
}

interface LanguageContentMeta {
  languageCode: string;
  totalGamesAvailable: number;
  gameDetails: Record<GameIdentifier, { puzzleCount: number; lastUpdated: string }>;
}
```

- If game not in `supportedGames`: show `EmptyStateCard` with "Puzzles Coming Soon!"
- Optional "Notify Me" button for when content drops

---

### 7. Master Language Data Model

```typescript
export type LanguageStatus = 'available' | 'coming-soon' | 'restricted';

export interface Language {
  code: string;           // 'en', 'es', 'fr', 'ja', 'ko', 'zh-CN', 'zh-TW'
  name: string;           // English name
  nativeName: string;     // Native name (Êó•Êú¨Ë™û, ÌïúÍµ≠Ïñ¥, ÁÆÄ‰Ωì‰∏≠Êñá)
  flagEmoji: string | null;
  status: LanguageStatus;
  scriptType: 'latin' | 'cjk' | 'indic' | 'arabic';
  supportedGames: GameIdentifier[];
}
```

---

## Task 2: Pimsleur-Style Audio Learning Module

### 1. Information Architecture

**Routes:**
- `/audio-lessons` ‚Äî Language grid
- `/audio-lessons/:langCode` ‚Äî Level selector (A1‚ÄìB2)
- `/audio-lessons/:langCode/:level` ‚Äî Lesson list
- `/audio-lessons/:langCode/:level/:lessonNum` ‚Äî Active lesson player

**Component Hierarchy:**

```typescript
// AudioLessonsPage.tsx ‚Äî Parent route
// AudioLanguageGrid.tsx ‚Äî Language selection grid
interface AudioLanguageGridProps {
  languages: AudioLanguageMeta[];
  onSelectLanguage: (langCode: string) => void;
}

// AudioLevelSelector.tsx ‚Äî A1/A2/B1/B2 cards
interface AudioLevelSelectorProps {
  languageCode: string;
  levels: AudioLevelMeta[];
  onSelectLevel: (levelCode: string) => void;
}

// AudioLessonCard.tsx ‚Äî Individual lesson
interface AudioLessonCardProps {
  lesson: AudioLessonMeta;
  onStartResume: (lessonId: string) => void;
}
```

**Tailwind:**
```html
<!-- Language/Level grid -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 p-4 max-w-4xl mx-auto">
  <div class="relative flex flex-col justify-between p-6 rounded-2xl border border-border/50 bg-background/70 backdrop-blur-md shadow-lg cursor-pointer hover:bg-background/80 transition-colors duration-200 min-h-[160px]">
    <!-- Progress bar -->
    <div class="w-full h-2 bg-background/50 rounded-full overflow-hidden mt-4">
      <div class="h-full bg-accent transition-all duration-300" style="width: {progress}%;" />
    </div>
  </div>
</div>

<!-- Lesson card -->
<div class="flex flex-col p-5 rounded-2xl border border-border/50 bg-background/60 backdrop-blur-md shadow-md hover:bg-background/70 transition-colors duration-200">
  <h4 class="font-heading text-xl text-foreground mb-2">{title}</h4>
  <button class="mt-auto self-start rounded-md bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-3 py-1.5 text-sm font-medium">
    {progress > 0 ? 'Resume Lesson' : 'Start Lesson'}
  </button>
</div>
```

**Card hover animation:**
```typescript
<motion.div
  whileHover={{ scale: 1.02, boxShadow: "0 8px 24px rgba(0, 0, 0, 0.3)" }}
  transition={{ type: "spring", stiffness: 400, damping: 10 }}
/>
```

---

### 2. Core Audio Drill Loop

**Flow:** Listen ‚Üí Understand ‚Üí Speak ‚Üí Feedback

**States:**
1. **Listen**: Phrase blurred, SpeechSynthesis plays, play button active
2. **Understand**: "Reveal Translation" button, text unblurs on tap
3. **Speak**: Mic button appears (large, animated), SpeechRecognition activates
4. **Feedback**: Confidence-based ‚Äî >0.8 "Excellent!", >0.6 "Almost there!", <0.6 "Let's try again"

**Component Hierarchy:**

```typescript
// AudioPlayerScreen.tsx ‚Äî Full-screen lesson player
interface AudioPlayerScreenProps {
  lessonId: string;
  language: Language;
  phrases: AudioLessonPhrase[];
  onLessonComplete: () => void;
  onExit: () => void;
}

// AudioDrillStep.tsx ‚Äî Individual drill step UI
interface AudioDrillStepProps {
  phrase: AudioLessonPhrase;
  step: 'listen' | 'understand' | 'speak' | 'feedback';
  feedback?: 'correct' | 'needs-practice' | 'incorrect';
  onAdvance: () => void;
  showTranslation: boolean;
}

// MicrophoneButton.tsx ‚Äî Animated mic
interface MicrophoneButtonProps {
  isListening: boolean;
  onToggleListen: () => void;
  disabled?: boolean;
}
```

**Tailwind (Audio Player):**
```html
<div class="flex flex-col items-center justify-center h-screen bg-background text-foreground p-4">
  <!-- Progress bar (absolute top) -->
  <div class="w-full max-w-lg h-2 bg-background/50 rounded-full overflow-hidden absolute top-0 left-0 right-0 z-10">
    <div class="h-full bg-primary transition-all duration-300" />
  </div>

  <!-- Phrase display -->
  <p class="font-heading text-4xl sm:text-5xl text-foreground text-center mb-8
    {blurred ? 'text-foreground/30 filter blur-sm' : ''}" />

  <!-- Translation -->
  <p class="font-body text-lg text-muted-foreground text-center" />

  <!-- Mic button -->
  <button class="rounded-full bg-primary hover:bg-primary/90 transition-all duration-300
    {isListening ? 'w-24 h-24 sm:w-28 sm:h-28 bg-accent animate-pulse' : 'w-20 h-20 sm:w-24 sm:h-24'}" />
</div>
```

**Framer Motion (phrase transitions):**
```typescript
<motion.p
  key={phrase.id}
  initial={{ opacity: 0, y: 20 }}
  animate={{ opacity: 1, y: 0 }}
  exit={{ opacity: 0, y: -20 }}
  transition={{ duration: 0.3 }}
/>

// Feedback pop-in
<motion.div
  initial={{ opacity: 0, scale: 0.8 }}
  animate={{ opacity: 1, scale: 1 }}
  transition={{ type: "spring", stiffness: 500, damping: 30 }}
/>
```

---

### 3. Spaced Repetition + Visual UI

**SR Mechanism:**
- Within lesson: incorrect phrases repeat more frequently
- Across sessions: SM-2 algorithm (easeFactor, interval, nextReviewAt)

**Visual UI during audio:**
- Subtle pulsating background gradient (burnt-orange ‚Üí forest-green)
- PhraseProgressDots: tiny colored dots below progress bar

```typescript
interface UserPhraseProgress {
  phraseId: string;
  lessonId: string;
  lastReviewedAt: string;
  nextReviewAt: string;
  interval: number;         // Days
  easeFactor: number;       // SM-2 ease factor
  correctAttempts: number;
  totalAttempts: number;
  status: 'new' | 'learning' | 'review' | 'mastered';
}
```

**Background Visualiser:**
```typescript
<motion.div
  initial={{ opacity: 0 }}
  animate={{
    opacity: isPlaying || isListening ? 0.2 : 0,
    scale: isPlaying || isListening ? [1, 1.05, 1] : 1
  }}
  transition={{ duration: 2, repeat: Infinity, ease: "easeInOut" }}
  class="absolute inset-0 z-0 bg-gradient-to-br from-primary to-accent"
/>
```

**Phrase dots:**
```html
<div class="absolute top-8 left-1/2 -translate-x-1/2 flex gap-1">
  <span class="w-2 h-2 rounded-full {
    pending: 'bg-foreground/30',
    correct: 'bg-accent',
    'needs-practice': 'bg-primary',
    incorrect: 'bg-red-500'
  }" />
</div>
```

---

### 4. Web Speech API ‚Äî Premium Feel

**SpeechSynthesis tricks:**
- Prioritise Google/Apple voices via `getVoices().filter(v => v.name.includes('Google'))`
- Rate: 0.9 (slightly slower = instructional)
- Pitch: 0.9‚Äì1.1 (subtle variation for naturalness)
- Pauses: `setTimeout` between utterances (500‚Äì1500ms)
- Pre-load voices on lesson init

**SpeechRecognition tricks:**
- `recognition.lang` = exact BCP 47 tag (e.g., `es-ES`, `ja-JP`)
- `recognition.interimResults = true` ‚Üí live transcription (premium feel)
- `recognition.continuous = false` ‚Üí single phrase mode
- Confidence scoring: >0.8 = correct, >0.6 = needs practice, <0.6 = incorrect

**AudioEngine service class:**
```typescript
class AudioEngine {
  private synthesis: SpeechSynthesis;
  private recognition: SpeechRecognition;
  private voices: SpeechSynthesisVoice[] = [];
  private currentVoice: SpeechSynthesisVoice | null = null;

  setLanguage(langCode: string, gender: 'male' | 'female' = 'female'): void;
  speak(text: string, rate?: number, pitch?: number): Promise<void>;
  listen(): Promise<{ transcript: string; confidence: number }>;
  stopListening(): void;
  stopSpeaking(): void;
}
```

---

### 5. Mic Permission Flow

**States:** `initial` ‚Üí `denied-once` ‚Üí `denied-persistent`

**Flow:**
1. Custom branded modal BEFORE browser prompt (explains why)
2. "Grant Access" triggers `navigator.mediaDevices.getUserMedia({ audio: true })`
3. If denied: updated message with "How to enable" link
4. If persistently denied: instructions for browser/system settings

```typescript
interface MicPermissionModalProps {
  isOpen: boolean;
  onClose: () => void;
  onGrantAttempt: () => void;
  status: 'initial' | 'denied-once' | 'denied-persistent';
}
```

---

### 6. Progress/Mastery Tracking

```typescript
export type AudioLevelCode = 'A1' | 'A2' | 'B1' | 'B2';
export type LessonMastery = 'not-started' | 'in-progress' | 'completed' | 'mastered';

interface AudioLessonMeta {
  id: string;
  languageCode: string;
  levelCode: AudioLevelCode;
  lessonNum: number;
  title: string;
  duration: number;      // minutes
  phrasesCount: number;
  progress: number;      // 0-100
  mastery: LessonMastery;
  lastPlayedAt: string | null;
  isUnlocked: boolean;
}

interface UserAudioLessonProgress {
  userId: string;
  lessonId: string;
  progress: number;
  mastery: LessonMastery;
  lastPlayedAt: string;
  completedAt: string | null;
  totalDrillTimeSeconds: number;
  phraseProgress: Record<string, UserPhraseProgress>;
}

interface UserLanguageAudioProgress {
  userId: string;
  languageCode: string;
  totalLessonsCompleted: number;
  totalPhrasesMastered: number;
  overallMasteryScore: number;
}
```

**Streak integration:** Audio completion counts towards daily learning streak (same üå±‚Üíüî•‚Üíüíé tiers).

---

### 7. Offline Considerations

**Strategy:**
- Service Worker caches HTML/CSS/JS + lesson phrase data
- Progress stored in IndexedDB, synced when online
- `SpeechSynthesis`: works offline IF device has local voices (Apple voices = yes, some Google = no)
- `SpeechRecognition`: requires network for most browsers ‚Üí falls back to self-assessment mode

**Offline self-assessment UI:**
```html
<div class="flex flex-col items-center mt-12">
  <p class="font-body text-lg text-muted-foreground mb-4">Offline: Self-assess your pronunciation.</p>
  <div class="flex gap-4">
    <button class="rounded-md bg-accent text-accent-foreground h-10 px-4">I got it!</button>
    <button class="rounded-md bg-primary text-primary-foreground h-10 px-4">Needs practice</button>
  </div>
</div>
```

**Offline banner:**
```html
<div class="fixed top-0 left-0 right-0 z-50 bg-primary text-primary-foreground text-center p-2 text-sm font-body">
  You are offline. Limited functionality available.
</div>
```

---

### 8. Completion Share Mechanics

```typescript
interface AudioCompletionShareCardProps {
  language: Language;
  levelCode: AudioLevelCode;
  lessonTitle: string;
  totalPhrasesMasteredInLesson: number;
  totalTimeSpent: string;
  shareText: string;
}
```

Uses same `navigator.share` / clipboard fallback as game share cards.

---

### 9. Funnel Connection (Games ‚Üí Audio ‚Üí Tutor)

1. **Games ‚Üí Audio**: Post-game CTA: "Ready to hear how it sounds? Try an Audio Lesson!"
2. **Audio ‚Üí Tutor**: Post-lesson CTA: "Want to practice with a native speaker? Book a tutor!"
3. **Struggling phrases**: "Book a tutor to help with this!" when repeated failures
4. **B1/B2 threshold**: Increase tutor booking CTA prominence at higher levels

---

### 10. New Design Tokens Summary

```css
:root {
  /* CJK fonts */
  --font-family-cjk: "Manrope", "Noto Sans JP", "Noto Sans KR", "Noto Sans SC", sans-serif;

  /* Game tiles */
  --game-tile-size-latin-sm: 48px;
  --game-tile-size-latin-md: 56px;
  --game-tile-size-latin-lg: 64px;
  --game-tile-size-cjk-sm: 60px;
  --game-tile-size-cjk-md: 70px;
  --game-tile-size-cjk-lg: 80px;
  --game-grid-gap: 8px;

  /* Audio module */
  --audio-progress-color-bg: #3E5641;
  --audio-progress-color-track: rgba(45, 42, 38, 0.5);
  --color-feedback-correct: #3E5641;
  --color-feedback-needs-practice: #D36135;
  --color-feedback-incorrect: #EF4444;
  --audio-blur-strength: blur(8px);
}
```
